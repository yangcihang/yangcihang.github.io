<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=">


  <link rel="mask-icon" href="/images/logo.svg?v=" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="无喵不欢">
<meta property="og:type" content="website">
<meta property="og:title" content="猫的储物间">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="猫的储物间">
<meta property="og:description" content="无喵不欢">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="猫的储物间">
<meta name="twitter:description" content="无喵不欢">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>猫的储物间</title>
  








</head>

<!-- 背景 -->

<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
    <!-- head -->
    <a href="https://github.com/yangcihang/">
      <img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/567c3a48d796e2fc06ea80409cc9dd82bf714434/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png">
    </a>
    <header id="header" 
    class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">猫的储物间</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">我是Android喵</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/21/Android消息机制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Catango">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="猫的储物间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/21/Android消息机制/" itemprop="url">Android消息机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-21T23:13:29+08:00">
                2017-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Handler简介"><a href="#Handler简介" class="headerlink" title="Handler简介"></a>Handler简介</h2><p>我们都知道Handler是Android消息机制的上层接口，用Handler可以将一个任务切换到Handler所在的线程去执行。Handler最最常见的操作就是在子线程中来更新UI线程的视图。常用的方法有：</p>
<ul>
<li>void handleMessage(Message msg)处理消息的方法,通常是用于被重写</li>
<li>sendEmptyMessage(int what)sendEmptyMessageDelayed(int what,long delayMillis) 发送空消息</li>
<li>sendMessage(Message msg):sendMessageDelayed(Message msg):发送消息</li>
<li>final boolean hasMessage(int what):检查消息队列中是否包含what属性为指定值的消息 如果是参数为(int what,Object object):除了判断what属性,还需要判断Object属性是否为指定对象的消息</li>
<li>post(Runnable r),postDelayed(Runnable r, long delayMillis)Runnable的执行是在Handler对象所在的线程，因此如果Handler在主线程的话，还是别用这个方法来执行耗时操作了，不然就ANR。</li>
</ul>
<h2 id="消息机制"><a href="#消息机制" class="headerlink" title="消息机制"></a>消息机制</h2><p>Android消息机制其实上是Handler的运行机制及Handler附带的MessageQueue和Looper的工作过程。这里先说明一点，安卓UI控件是线程不安全的，因此不允许在子线程中对UI控件进行修改。那为啥设计的时候不加锁呢？可能是加锁会降低访问效率和阻塞线程的原因。</p>
<p>Handler创建的时候会采用当前线程的Looper来构建内部的消息循环系统，如果当前线程没有Looper，就会报错。主线程默认会创建Looper。当Handler创建完毕后，这时候内部的Looper以及MessageQueue就可以和Handler一起工作了。然后通过Handler的post方法将一个Runnable传递到Looper中去处理，或者通过Handler的send方法发送消息，这个消息同样也会在Looper中去处理。其实post方法最终也是通过send方法来完成的。当Handler的send方法调用时，它会调用MessageQueue的enqueueMessage方法将这个消息放入消息队列，然后Looper发现有新的消息的时候，就会处理这个消息，最终消息的Runnable或者Handler的handleMessage方法就会被调用。在介绍这三个机制之前先说说java.lang包下面的ThreadLocal类吧。</p>
<h3 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h3><p>什么是ThreadLocal呢？ThreadLocal是java.lang包下面的一个线程内部的数据存储类，通过它可以在指定线程存储指定数据，并且只有在指定线程中获得存储的数据。一般来说，当某些数据是以线程为作用域并且不同线程具有不同的数据副本时，就可以考虑ThreadLocal。举个栗子：监听器的传递，如果一个线程中做了大量工作而且需要一个监听器来贯穿整个线程的执行过程，就可以使用ThreadLocal，在线程内部使用ThreadLocal的get方法来获取到监听器。举个ThreadLocal简单的例子，在主线程中创建一个ThreadLocal的实例，类型选择为int型的，并且在主线程中用set方法设置为1，然后在子线程1中set为2，子线程2中不进行任何操作。如果将三个线程调用get方法，则在主线程中会显示1，在子线程1中显示2，在子线程2中则会显示null.虽然在不同线程中访问的是同一个ThreadLocal的对象，但是他们的值是不同的。为什么会这样呢？来看看get方法的源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">  public void set(T value) &#123;</div><div class="line">        Thread t = Thread.currentThread();</div><div class="line">        ThreadLocalMap map = getMap(t);</div><div class="line">        if (map != null)</div><div class="line">            map.set(this, value);</div><div class="line">        else</div><div class="line">            createMap(t, value);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">public T get() &#123;</div><div class="line">        Thread t = Thread.currentThread();</div><div class="line">        ThreadLocalMap map = getMap(t);</div><div class="line">        if (map != null) &#123;</div><div class="line">            ThreadLocalMap.Entry e = map.getEntry(this);</div><div class="line">            if (e != null)</div><div class="line">                return (T)e.value;</div><div class="line">        &#125;</div><div class="line">        return setInitialValue();</div><div class="line">    &#125;</div><div class="line">```    </div><div class="line">我们可以看到，每个Thread都会对应一个ThreadLocalMap，ThreadLocalMap其实是ThreadLocal的一个私有内部类，在ThreadLocal里面set的时候会调用map的set方法将数据存储在一个叫Entry的数组里面。为啥要先说这个ThreadLocal呢？因为等会介绍的Looper的作用域就是线程并且不同线程具有不同的Looper。</div><div class="line"></div><div class="line">### MessageQueue</div><div class="line">MessageQueue顾名思义，就是存放Message的队列，然而它内部的数据结构并不是队列，而是用单链表存储的消息列表，因为链表的插入删除很方便。主要有俩方法：enqueueMessage和next。其中enqueueMessage会在Handler每次发送Message时候调用，将Message加入链表之中。源码也是将Message插入链表的意思。然后主要是里面的next方法：</div></pre></td></tr></table></figure>
<p>Message next() {<br>        // Return here if the message loop has already quit and been disposed.<br>        // This can happen if the application tries to restart a looper after quit<br>        // which is not supported.<br>        final long ptr = mPtr;<br>        if (ptr == 0) {<br>            return null;<br>        }</p>
<pre><code>int pendingIdleHandlerCount = -1; // -1 only during first iteration
int nextPollTimeoutMillis = 0;
for (;;) {
    if (nextPollTimeoutMillis != 0) {
        Binder.flushPendingCommands();
    }

    nativePollOnce(ptr, nextPollTimeoutMillis);

    synchronized (this) {
        // Try to retrieve the next message.  Return if found.
        final long now = SystemClock.uptimeMillis();
        Message prevMsg = null;
        Message msg = mMessages;
        if (msg != null &amp;&amp; msg.target == null) {
            // Stalled by a barrier.  Find the next asynchronous message in the queue.
            do {
                prevMsg = msg;
                msg = msg.next;
            } while (msg != null &amp;&amp; !msg.isAsynchronous());
        }
        if (msg != null) {
            if (now &lt; msg.when) {
                // Next message is not ready.  Set a timeout to wake up when it is ready.
                nextPollTimeoutMillis = (int) Math.min(msg.when - now, Integer.MAX_VALUE);
            } else {
                // Got a message.
                mBlocked = false;
                if (prevMsg != null) {
                    prevMsg.next = msg.next;
                } else {
                    mMessages = msg.next;
                }
                msg.next = null;
                if (DEBUG) Log.v(TAG, &quot;Returning message: &quot; + msg);
                msg.markInUse();
                return msg;
            }
        } else {
            // No more messages.
            nextPollTimeoutMillis = -1;
        }
        ......
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">很明显这个next方法是个for无限循环的方法。如果没有消息的话会一直阻塞在这，当有消息到来时会将其从单链表中移除。这个next方法会在接下来的Looper的某一方法中调用。</div><div class="line"></div><div class="line">### Looper</div><div class="line">Looper是一个不停地在MessageQueue中查看是否有新消息的一个东西。如果没有新消息就会阻塞在那里。**在它的构造方法里面会创建一个本线程的MessageQueue**，然后将当前线程的对象保存起来。一般如果要在Android的非UI线程中进行跨线程的操作时，就需要创建一个Looper（因为UI线程的Looper比较特殊，会在一开始就创建）。Looper提供了quit和quitSafely方法，区别是前者是立即退出，后者是处理完MessageQueue中的所有Message后退出。当Looper退出后，Handler的sendMessage方法就会返回false。先看看Looper的prepare的方法：</div></pre></td></tr></table></figure>
<p> public static void prepare() {<br>        prepare(true);<br>    }</p>
<pre><code>private static void prepare(boolean quitAllowed) {
    if (sThreadLocal.get() != null) {
        throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;);
    }
    sThreadLocal.set(new Looper(quitAllowed));
}
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">可以看到，prepare的方法会调用ThreadLocal的set方法set一个Looper的一个对象。这样就保证了Looper在不同线程中有不同的Looper存在。然后咱们看看Looper中最核心的方法：loop</div></pre></td></tr></table></figure>
<p>  public static void loop() {<br>        final Looper me = myLooper();<br>        if (me == null) {<br>            throw new RuntimeException(“No Looper; Looper.prepare() wasn’t called on this thread.”);<br>        }<br>        final MessageQueue queue = me.mQueue;</p>
<pre><code>    // Make sure the identity of this thread is that of the local process,
    // and keep track of what that identity token actually is.
    Binder.clearCallingIdentity();
    final long ident = Binder.clearCallingIdentity();

    for (;;) {
        Message msg = queue.next(); // might block
        if (msg == null) {
            // No message indicates that the message queue is quitting.
            return;
        }

        // This must be in a local variable, in case a UI event sets the logger
        final Printer logging = me.mLogging;
        if (logging != null) {
            logging.println(&quot;&gt;&gt;&gt;&gt;&gt; Dispatching to &quot; + msg.target + &quot; &quot; +
                    msg.callback + &quot;: &quot; + msg.what);
        }

        final long traceTag = me.mTraceTag;
        if (traceTag != 0 &amp;&amp; Trace.isTagEnabled(traceTag)) {
            Trace.traceBegin(traceTag, msg.target.getTraceName(msg));
        }
        try {
            msg.target.dispatchMessage(msg);
        } finally {
            if (traceTag != 0) {
                Trace.traceEnd(traceTag);
            }
        }

        if (logging != null) {
            logging.println(&quot;&lt;&lt;&lt;&lt;&lt; Finished to &quot; + msg.target + &quot; &quot; + msg.callback);
        }

        // Make sure that during the course of dispatching the
        // identity of the thread wasn&apos;t corrupted.
        final long newIdent = Binder.clearCallingIdentity();
        if (ident != newIdent) {
            Log.wtf(TAG, &quot;Thread identity changed from 0x&quot;
                    + Long.toHexString(ident) + &quot; to 0x&quot;
                    + Long.toHexString(newIdent) + &quot; while dispatching to &quot;
                    + msg.target.getClass().getName() + &quot; &quot;
                    + msg.callback + &quot; what=&quot; + msg.what);
        }

        msg.recycleUnchecked();
    }
}
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">可以看到，loop中有一个for的无限循环，当MessageQueue的next方法返回为空时，退出这个循环。前面刚说过了这个next方法是一个阻塞的方法，当MessageQueue被标记为退出状态时，这个next就会返回一个null。其实Looper的quit方法就是调用MessageQueue方法中的quit来实现的。接下来当获取到消息的时候，会执行msg.target.dispatchMessage方法。这个target就是发送消息的Handler对象，这个dispatchMessage方法接下来会说。</div><div class="line"></div><div class="line">### Handler</div><div class="line">先说明一点，Handler中的post方法最终都会执行到sendMessageAtTime这个方法中去，然后将Message加入MessageQueue中。然后Looper会不停的循环这个MessageQueue，当取出消息后就会执行到Handler的dispatchMessage的方法中去。</div></pre></td></tr></table></figure>
<pre><code>public void dispatchMessage(Message msg) {
    if (msg.callback != null) {
        handleCallback(msg);
    } else {
        if (mCallback != null) {
            if (mCallback.handleMessage(msg)) {
                return;
            }
        }
        handleMessage(msg);
    }
}
</code></pre><p>```<br>可以看到这个方法也是很简单就理解的。其中这个callback是一个Runnable对象，实际上就是Handler的post方法中的Runnable。然后检查这个Callback是否为空。这个Callback其实是一个接口，在handler初始化的时候传入的。这个接口可以实现处理Message的一些方法，其实和Handler的handlerMessage方法一样，用这个接口的话可以避免写Handler子类去做一些处理。最后调用的这个方法应该很熟悉吧？没错，平常创建Handler时候重写的那个方法，其实它是在dispatchMessage方法中进行回调的。</p>
<p>参考文献：Android开发艺术探究</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/21/TabLayout简介/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Catango">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="猫的储物间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/21/TabLayout简介/" itemprop="url">TabLayout简介</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-21T23:12:48+08:00">
                2017-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在app的主页等地方加入tabs是很常见的，它有许多实现方式，比如自定义控件等。在Google的Design库中，推出了TabLayout这么一个布局来方便开发者们实现tab的效果。TabLayout提供了一个水平的布局用来展示Tabs。<a href="http://www.jianshu.com/p/2b2bb6be83a8" title="参考链接" target="_blank" rel="external">参考链接</a></p>
<h2 id="TabLayout的相关属性"><a href="#TabLayout的相关属性" class="headerlink" title="TabLayout的相关属性"></a>TabLayout的相关属性</h2><ol>
<li><p>改变选中字体的颜色</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2. 改变未选中字体的颜色</div><div class="line">	```app:tabTextColor=&quot;@color/colorPrimary&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>改变指示器下标的颜色</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">4. 改变整个TabLayout的颜色</div><div class="line">	```app:tabBackground=&quot;color&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>改变指示器下表高度</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">6. （代码中）添加tab</div><div class="line">	```tabLayout.addTab(tabLayout.newTab().setText(&quot;123&quot;))</div></pre></td></tr></table></figure>
</li>
<li><p>（布局文件中）添加tab<br> 在TabLaytou标签下面，添加TabItem标签即可。</p>
</li>
<li><p>添加图标</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">9. 设置模式</div><div class="line">	有固定和滚动模式可选择</div><div class="line">	```app:tabMode = &quot;scrollable&quot;</div></pre></td></tr></table></figure>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">10. Tab宽度限制</div><div class="line">	```app:tabMaxWidth=&quot;xxxdp&quot;</div></pre></td></tr></table></figure>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">11. 最重要的，和ViewPager联动</div><div class="line">	和ViewPager联动，需要重写adapter 的getPagerTitle方法,否则无法显示TabLayout上的标签</div><div class="line">	```tabLayout.setupWithViewPager(vp)</div></pre></td></tr></table></figure>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/21/自定义Notification/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Catango">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="猫的储物间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/21/自定义Notification/" itemprop="url">自定义Notification</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-21T23:12:03+08:00">
                2017-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Notification简介"><a href="#Notification简介" class="headerlink" title="Notification简介"></a>Notification简介</h2><p>Notification是安卓开发中常用的组件之一，不过Notification在每个版本里面都有差别（安卓8.0在前台服务设置Notification的话貌似有点问题，不知道为啥在服务中start不上去…）常见的创建有两种，一种是直接构造，另一种是使用builder模式来创建，最后都用manager来notify出来（不是本文重点）。不过原生的Notification样式肯定不在各个场合都适用，因此我们有时候需要自定义Notification样式来满足不同的需求。在此之前，先简单介绍Notification中需要的一些组件。</p>
<h2 id="RemoteViews简介"><a href="#RemoteViews简介" class="headerlink" title="RemoteViews简介"></a>RemoteViews简介</h2><ul>
<li>RemoteViews不是当前进程的View,是属于SystemServer进程.因此可以在一些前台操作中来使用，避免一直占用UI线程的资源。应用程序和RemoteViews之间可以通过Binder来实现进程的通信。</li>
<li>应用程序与RemoteViews之间依赖Binder实现了进程间通信.RemoteViews使用最多的场合是通知栏和桌面小插件.</li>
<li>RemoteViews并不能直接获得控件实例,然后对控件进行操作.它提供了<br>setTextViewText(viewId, text)、setImageViewResource(viewId, srcId)等方法进行操作,传入控件id和相应的修改内容. 常用的属性有：<ul>
<li>setTextViewText(viewId, text)设置文本</li>
<li>setTextColor(viewId, color)设置文本颜色</li>
<li>setTextViewTextSize(viewId, units, size)设置文本大小 </li>
<li>setImageViewBitmap(viewId, bitmap)设置图片</li>
<li>setImageViewResource(viewId, srcId)根据图片资源设置图片</li>
<li>setViewPadding(viewId, left, top, right, bottom)设置Padding间距<ul>
<li>setOnClickPendingIntent(viewId, pendingIntent)设置点击事件 </li>
</ul>
</li>
</ul>
</li>
<li>RemoteViews的实现底层原理  最好百度看看吧…挺有意思的，这儿不是本文的重点</li>
</ul>
<h2 id="PendingIntent简介"><a href="#PendingIntent简介" class="headerlink" title="PendingIntent简介"></a>PendingIntent简介</h2><ul>
<li>如果你写过Notification的话，PendingIntent应该有一定的了解。这儿再介绍一下：PendingIntent是”延迟意图”的意思,就是当满足某一条件时出触发这个Intent，通过PendingIntent的getActivity、getBroadcast、getService等分别构建一个打开对应组件的延迟Intent. </li>
<li>传入四个参数，context、intent、requestCode(自定义)、flag.<br>比如这样初始化：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Intent intent=new Intent(MainActivity.this,MainActivity.class);</div><div class="line">PendingIntent mPendingIntent=PendingIntent.getActivity(MainActivity.this, 0, intent, PendingIntent.FLAG_UPDATE_CURRENT);</div></pre></td></tr></table></figure>
<ul>
<li><p>PendingIntent有4种flag</p>
<ul>
<li>FLAG_ONE_SHOT                只执行一次，然后就被cancel了</li>
<li>FLAG_NO_CREATE               若描述的Intent不存在则返回NULL值（不懂这个具体用来是干啥的）</li>
<li>FLAG_CANCEL_CURRENT          如果描述的PendingIntent已经存在，则在产生新的Intent之前会先取消掉当前的PendingIntent。对于通知栏的消息来说，以前被取消的PendingIntent就无法启用。这种情况最常见的就是IM的后台消息提示了。</li>
<li>FLAG_UPDATE_CURRENT          总是执行，表示描述的PendingIntent如果存在，那么它们都会更新。也就是说里面的intent的Extras会被更替为最新。</li>
</ul>
</li>
<li>PendingIntent的匹配规则：requestCode表示PendingIentent发送方的请求码，多情况下设为0即可。requestCode会影响到flags效果。<br>如果两个PendingIntent它们内部的Intent相同并且requestCode也相同，那么这两个PendingIntent就是相同的。intent的匹配规则是：如果两个Intent的ComponentName和intent-filter都相同，那么这两个Intent就是相同的。注意Extras不参与Intent的匹配过程。这点很重要的，因为后面的RemoteViews的监听事件需要PendingIntent来具体实现。</li>
<li>和intent的区别<ol>
<li>Intent是立即使用的，而PendingIntent可以等到事件发生后触发，PendingIntent可以cancel</li>
<li>Intent在程序结束后即终止，而PendingIntent在程序结束后依然有效</li>
<li>PendingIntent自带Context，而Intent需要在某个Context内运行</li>
<li>Intent在原task中运行，PendingIntent在新的task中运行</li>
</ol>
</li>
</ul>
<h2 id="自定义步骤"><a href="#自定义步骤" class="headerlink" title="自定义步骤"></a>自定义步骤</h2><ol>
<li><p>自定义通知的布局。 这个没啥好说的。。。不过这个只支持部分组件<br>  Layout ：FrameLayout,LinearLayout,RelativeLayout，GridLayout<br>  View ：AnalogClock，Button，Chronometer，ImageButton，ImageView，ProgressBar，TextView，ViewFlipper，ListView，GridView，StackView，AdapterViewFilter，ViewStub。</p>
</li>
<li><p>使用RemoteView来加载这个布局。RemoteViews没有提供findViewById方法，因此无法直接访问里面的View元素。必须通过RemoteViews所提供的一些列set方法来完成。举个例子：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">remoteView = new RemoteViews(this.getPackageName(), R.layout.view_music_player_notification);</div><div class="line">Intent intent = new Intent(BROADCAST_NAME);</div><div class="line">intent.putExtra(KEY_FLAG, FLAG_NEXT);</div><div class="line">PendingIntent nextPendingIntent = PendingIntent.getBroadcast(this, FLAG_NEXT, intent, FLAG_UPDATE_CURRENT);</div><div class="line">remoteView.setOnClickPendingIntent(R.id.img_next, nextPendingIntent);</div><div class="line">intent.putExtra(KEY_FLAG, FLAG_PRE);</div><div class="line">PendingIntent prePendingIntent = PendingIntent.getBroadcast(this, FLAG_PRE, intent, FLAG_UPDATE_CURRENT);</div><div class="line">remoteView.setOnClickPendingIntent(R.id.img_previous, prePendingIntent);</div><div class="line">intent.putExtra(KEY_FLAG, FLAG_PAUSE);</div><div class="line">PendingIntent pausePendingIntent = PendingIntent.getBroadcast(this, FLAG_PAUSE, intent, FLAG_UPDATE_CURRENT);</div></pre></td></tr></table></figure>
</li>
</ol>
<p>这是一个用广播来实现音乐播放器的例子。这个播放器就是通知栏展示的那种。</p>
<ol>
<li><p>使用RemoteView实例创建Notification。这个简单，如果是buider模式的话，调用setContent方法，此时的参数要求就是RemoteViews。如果是直接构造的话，将RemoteViews直接赋值给notification的ContentView。</p>
</li>
<li><p>处理事件。事件是通过intent的action来标识的，而intent是“嵌套”在PendingIntent中的，因此点击后，先根据PendingIntent的类型来决定的。这个时候可以用intent进行参数传递，再在相应的代码块中实现相应的方法。比如上面的PendingIntent是构建了一个打开广播的intent，因此我们可以在相应的BroadcastReceiver中进行相关方法的实现。</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/21/ScrollView嵌套ListView问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Catango">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="猫的储物间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/21/ScrollView嵌套ListView问题/" itemprop="url">ScrollView嵌套ListView问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-21T23:11:20+08:00">
                2017-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题情形"><a href="#问题情形" class="headerlink" title="问题情形"></a>问题情形</h2><p> 当ListView外面嵌套一层ScrollView时，内层的ListView会有这样的问题：</p>
<ol>
<li>ListView的尺寸无法正确测量。如果不将高度固定的话，ListView只会显示一个Item。</li>
<li>ListView的滑动事件被截止。如果内容超过了屏幕的大小的话，会截止ListView的滑动事件。</li>
</ol>
<h2 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h2><p> 通常情况下，ViewGroup是不拦截事件的，但是ScrollView在onInterceptTouchEvent方法中，有这么几句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">if ((action == MotionEvent.ACTION_MOVE) &amp;&amp; (mIsBeingDragged)) &#123;</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line">//在动作事件中:</div><div class="line">  case MotionEvent.ACTION_MOVE: &#123;</div><div class="line"></div><div class="line">            final int activePointerId = mActivePointerId;</div><div class="line">            if (activePointerId == INVALID_POINTER) &#123;</div><div class="line">                // If we don&apos;t have a valid id, the touch down wasn&apos;t on content.</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            final int pointerIndex = ev.findPointerIndex(activePointerId);</div><div class="line">            if (pointerIndex == -1) &#123;</div><div class="line">                Log.e(TAG, &quot;Invalid pointerId=&quot; + activePointerId+ &quot; in onInterceptTouchEvent&quot;);</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            final int y = (int) ev.getY(pointerIndex);</div><div class="line">            final int yDiff = Math.abs(y - mLastMotionY);</div><div class="line">            if (yDiff &gt; mTouchSlop &amp;&amp; (getNestedScrollAxes() &amp; SCROLL_AXIS_VERTICAL) == 0) &#123;</div><div class="line">                mIsBeingDragged = true;</div><div class="line">                mLastMotionY = y;</div><div class="line">                initVelocityTrackerIfNotExists();</div><div class="line">                mVelocityTracker.addMovement(ev);</div><div class="line">                mNestedYOffset = 0;</div><div class="line">                if (mScrollStrictSpan == null) &#123;</div><div class="line">                    mScrollStrictSpan = StrictMode.enterCriticalSpan(&quot;ScrollView-scroll&quot;);</div><div class="line">                &#125;</div><div class="line">                final ViewParent parent = getParent();</div><div class="line">                if (parent != null) &#123;</div><div class="line">                    parent.requestDisallowInterceptTouchEvent(true);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            break;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">         case MotionEvent.ACTION_DOWN: &#123;</div><div class="line">            final int y = (int) ev.getY();</div><div class="line">            if (!inChild((int) ev.getX(), (int) y)) &#123;</div><div class="line">                mIsBeingDragged = false;</div><div class="line">                recycleVelocityTracker();</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            /*</div><div class="line">             * Remember location of down touch.</div><div class="line">             * ACTION_DOWN always refers to pointer index 0.</div><div class="line">             */</div><div class="line">            mLastMotionY = y;</div><div class="line">            mActivePointerId = ev.getPointerId(0);</div><div class="line"></div><div class="line">            initOrResetVelocityTracker();</div><div class="line">            mVelocityTracker.addMovement(ev);</div><div class="line"></div><div class="line">            mIsBeingDragged = !mScroller.isFinished();</div><div class="line">            if (mIsBeingDragged &amp;&amp; mScrollStrictSpan == null) &#123;</div><div class="line">                mScrollStrictSpan = StrictMode.enterCriticalSpan(&quot;ScrollView-scroll&quot;);</div><div class="line">            &#125;</div><div class="line">            startNestedScroll(SCROLL_AXIS_VERTICAL);</div><div class="line">            break;</div><div class="line">        &#125;</div></pre></td></tr></table></figure></p>
<p>这两段代码的意思是：如果ScrollView接收到move事件，并且正在滑动，那么它的onInterceptTouchEvent方法直接就返回true了，也就是拦截了滑动事件。当接收到了按下的事件，那么将 mIsBeingDragged直接置false，<br>mIsBeingDragged就表示当前ScrollView是否在滑动。里面还有这么一句mIsBeingDragged = !mScroller.isFinished();即如ScrollView还在滑动的时候，你想去触摸嵌在里面的ListView，ScrollView滑动还没结束呢，直接return true;<br>再来看看switch里面case MotionEvent.ACTION_MOVE，如果y轴方向上的滑动距离大于最小滑动距离，则将mIsBeingDragged设置为true。也就是说虽然我手指落在了子View里面，但是如果我要滑动的话，根据第一个if判断，会直接被拦截，交给ScrollView去处理。</p>
<h2 id="处理方法"><a href="#处理方法" class="headerlink" title="处理方法"></a>处理方法</h2><ul>
<li>ListView滑动拦截的处理，思路很简单：我们可以自定义一个ListView，去重写里面的dispatchTouchEvent方法，在它的 MotionEvent.ACTION_DOWN的事件调用:getParent().requestDisallowInterceptTouchEvent(true)方法，意思是通知其父组件不要拦截它的滑动事件。这时候一定要记着当ListView滑动到最底部和最顶部的时候要将滑动事件交给其父组件来处理。自定义的ListView代码如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">public class MyListView extends ListView &#123;</div><div class="line">    float y,downY;</div><div class="line">    float mTouchSlop = ViewConfiguration.getTouchSlop(); //获取滑动最小位移量</div><div class="line"></div><div class="line">    public MyListView(Context context) &#123;</div><div class="line">        super(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public MyListView(Context context, AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 对事件分发的重写</div><div class="line">     * @param ev</div><div class="line">     * @return</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public boolean dispatchTouchEvent(MotionEvent ev) &#123;</div><div class="line">        switch (ev.getAction()) &#123;</div><div class="line">            case MotionEvent.ACTION_DOWN:</div><div class="line">                downY = ev.getRawY();</div><div class="line">                y = downY;</div><div class="line">                getParent().requestDisallowInterceptTouchEvent(true);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_MOVE:</div><div class="line">                y = ev.getRawY();</div><div class="line">                /*</div><div class="line">                  判断滑动到顶部</div><div class="line">                 */</div><div class="line">                if (getFirstVisiblePosition() == 0) &#123;</div><div class="line">                    if (y - downY &gt; mTouchSlop) &#123;</div><div class="line">                        getParent().requestDisallowInterceptTouchEvent(false); </div><div class="line">                        return false;</div><div class="line">                    &#125; else if (y - downY &lt; -mTouchSlop) &#123;</div><div class="line">                        getParent().requestDisallowInterceptTouchEvent(true); //滑到顶部再向上，自己处理</div><div class="line"></div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                &#125;</div><div class="line">                /*</div><div class="line">                  判断滑动到底部</div><div class="line">                 */</div><div class="line">                if (getFirstVisiblePosition()+getChildCount()==getCount()) &#123;</div><div class="line">                    if (y - downY &lt; -mTouchSlop) &#123;</div><div class="line">                        getParent().requestDisallowInterceptTouchEvent(false);</div><div class="line">                        return false;</div><div class="line">                    &#125; else if (y - downY &gt; mTouchSlop) &#123;</div><div class="line">                        getParent().requestDisallowInterceptTouchEvent(true); //滑到底部再向下，自己处理</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_UP:</div><div class="line">                break;</div><div class="line">            default:</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">        return super.dispatchTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>对显示只有一项的情况处理：出现这种情况的原因是ScrollView嵌套ListView时，ListView无法正确计算大小，因此可以通过在其初始化的时候固定其大小来解决，但有时候并不知道View应该多大，这时候就得使用代码来控制了，具体的实现方法如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public void setListViewHeight(ListView listView) &#123;</div><div class="line">        ListAdapter adapter = listView.getAdapter();</div><div class="line">        int totalHeight = 0; //子View的总高度</div><div class="line">        int len  = adapter.getCount();</div><div class="line">        for (int i = 0; i &lt; len; i++) &#123;</div><div class="line">            View listItem = adapter.getView(i, null, listView);</div><div class="line">            listItem.measure(0, 0); //对子View进行测量</div><div class="line">            totalHeight += listItem.getMeasuredHeight();</div><div class="line">        &#125;</div><div class="line">        ViewGroup.LayoutParams params = listView.getLayoutParams();</div><div class="line">        params.height = totalHeight+ (listView.getDividerHeight() * (adapter.getCount() - 1));//加上分割线的高度</div><div class="line">        listView.setLayoutParams(params);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>在ListView加载完adapter后，可以通过调用上面的方法来实现对ListView的大小控制。其中的思路是先通过获得ListView的itemView的总数量，然后进行测量，测量后在重新设置ListView的参数。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/21/ListView和RecyclerView的刷新内容错乱问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Catango">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="猫的储物间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/21/ListView和RecyclerView的刷新内容错乱问题/" itemprop="url">ListView和RecyclerView的刷新内容错乱问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-21T23:09:57+08:00">
                2017-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、问题背景"><a href="#一、问题背景" class="headerlink" title="一、问题背景"></a>一、问题背景</h2><p>ListView和RecyclerView是最常用的控件，但是因为itemView的复用，会导致往返滑动后，EditText编辑或者RadioButton等控件会出现显示不正常的问题。这些问题都是因为第二次加载View的时候，缺少二次刷新后对控件的约束。因此解决问题的办法就是在初始化的时候添加约束。</p>
<h2 id="二、问题展示"><a href="#二、问题展示" class="headerlink" title="二、问题展示"></a>二、问题展示</h2><p>因为RecyclerView可以适配多种布局，功能比ListView强，因此以下例子都用RecyclerView示范。</p>
<h3 id="RadioButton的错乱。"><a href="#RadioButton的错乱。" class="headerlink" title="RadioButton的错乱。"></a>RadioButton的错乱。</h3><p>布局很简单，List里面是单纯的RadioButton，Activity中单纯的就是RecyclerView，Adapter中，Creat和绑定Holder的代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line"> public TestHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123;</div><div class="line">        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.view_rec_item,parent,false);</div><div class="line">        return new TestHolder(view);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onBindViewHolder(TestHolder holder, int position) &#123;</div><div class="line">        String item = mlist.get(position);</div><div class="line">        holder.testRbtn.setText(item);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>当点击5个RadioButton时：<br><img src="http://wiki.hrsoft.net/uploads/201705/59258a9abf0e9_59258a9a.png" alt=""><br>下拉后会发现：<br><img src="http://wiki.hrsoft.net/uploads/201705/59258af4d792e_59258af4.png" alt=""><br>然后再拉回：<br><img src="http://wiki.hrsoft.net/uploads/201705/59258b032da49_59258b03.png" alt=""><br>会发现没有选择过的button被选中了，拉回后选中的却又没了。</p>
<h2 id="三、如何解决："><a href="#三、如何解决：" class="headerlink" title="三、如何解决："></a>三、如何解决：</h2><p>前面提到过，所有的错乱原因都是itemView的复用造成，举个例子：对于RadioButton，当下拉时，因为前5个是点击的状态，复用View后，没有新的RadioButton的选择状态未被初始化，因此会错乱。</p>
<h3 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h3><p>对于每个view，用一bool数组来记录当前所有RadioButton是否选中的状态，然后在初始化的时候通过判断数组中每一个元素的状态来设置RadioButton的状态。代码如下：<br>1.在构造函数中，创建flagList的实例，默认全部设置为false<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">TestAdapter</span><span class="params">(List&lt;String &gt; list)</span> </span>&#123;</div><div class="line">      mlist = list;</div><div class="line">      flagList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span> ;i&lt;list.size();i++) &#123;</div><div class="line">          flagList.add(<span class="keyword">false</span>);</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>2.在BindViewHolder的函数中，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(TestHolder holder, <span class="keyword">final</span> <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">    String item = mlist.get(position);</div><div class="line">    holder.testRbtn.setText(item);</div><div class="line">    <span class="keyword">if</span>(flagList.get(position)) &#123;</div><div class="line">        holder.testRbtn.setChecked(<span class="keyword">true</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        holder.testRbtn.setChecked(<span class="keyword">false</span>);</div><div class="line">    &#125;</div><div class="line">    holder.testRbtn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">            flagList.set(position,!flagList.get(position));</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里对每个RadioButton做了初始化，判断flagList的每个元素的状态来设置RadioButton的状态，并且设置点击监听，点击后更新flagList。这样设置后，运行程序，会发现错乱的问题得到了解决。<br><strong>这里特别特别要注意一点：代码里面的if和else缺一不可，必须对每种状态都得初始化，如果仅有if没有else，还是会出现错乱的情况。</strong></p>
<h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><p>无论哪种的错位问题，都可以按照以上套路来。就是在加载每一项的View的时候将View中的控件初始化，比如EditText就添加TextChangedListener，文本改变后将文本存储在数组里面，然后加载View的时候取出，这样就可以避免错乱的情况了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/21/利用RecyclerView实现简单的布局混搭/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Catango">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="猫的储物间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/21/利用RecyclerView实现简单的布局混搭/" itemprop="url">利用RecyclerView实现简单的布局混搭</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-21T23:06:57+08:00">
                2017-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、Header和Footer"><a href="#一、Header和Footer" class="headerlink" title="一、Header和Footer"></a>一、Header和Footer</h2><p>有时候我们需要在ListView或者RecyclerView中添加一个Header或者一个Footer，ListView中有添加Header和Footer的函数，而RecyclerView中并没有。所以需要简单的配置来实现RecyclerView的Header和Footer。实现过程很简单，只需要重写自带的getItemViewType和onCreateViewHolder函数，然后自定义不同的holder，在bindViewHolder根据不同类型的holder来进行配置。</p>
<h3 id="首先，不要让adapter继承自自定义的Holder"><a href="#首先，不要让adapter继承自自定义的Holder" class="headerlink" title="首先，不要让adapter继承自自定义的Holder"></a>首先，不要让adapter继承自自定义的Holder</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span> &lt; <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> &gt;</span></div></pre></td></tr></table></figure>
<h3 id="其次，定义变量，重写getItemViewType方法和getCount的方法"><a href="#其次，定义变量，重写getItemViewType方法和getCount的方法" class="headerlink" title="其次，定义变量，重写getItemViewType方法和getCount的方法"></a>其次，定义变量，重写getItemViewType方法和getCount的方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">/item类型 </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ITEM_TYPE_HEADER = <span class="number">0</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ITEM_TYPE_CONTENT = <span class="number">1</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ITEM_TYPE_BOTTOM = <span class="number">2</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mHeaderCount=<span class="number">1</span>;<span class="comment">//头部View个数</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mBottomCount=<span class="number">1</span>;<span class="comment">//底部View个数</span></div><div class="line"> <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemViewType</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> dataItemCount = getContentItemCount();</div><div class="line">        <span class="keyword">if</span> (mHeaderCount != <span class="number">0</span> &amp;&amp; position &lt; mHeaderCount) &#123;</div><div class="line">            <span class="keyword">return</span> ITEM_TYPE_HEADER;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mBottomCount != <span class="number">0</span> &amp;&amp; position &gt;= (mHeaderCount + dataItemCount)) &#123;</div><div class="line">            <span class="keyword">return</span> ITEM_TYPE_BOTTOM;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> ITEM_TYPE_CONTENT;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">	 <span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">       <span class="keyword">return</span> mHeaderCount + getContentItemCount() + mBottomCount;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="然后根据不同类型的type返回不同的View，并且设置不同的ViewHolder"><a href="#然后根据不同类型的type返回不同的View，并且设置不同的ViewHolder" class="headerlink" title="然后根据不同类型的type返回不同的View，并且设置不同的ViewHolder"></a>然后根据不同类型的type返回不同的View，并且设置不同的ViewHolder</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//内容的Holder</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ContentViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> TextView textView;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ContentViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(itemView);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//头部Holder</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HeaderViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">HeaderViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(itemView);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//底部Holder</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BottomViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">BottomViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(itemView);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="comment">//根据不同的type获取不同的ViewHolder</span></div><div class="line"> <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> RecyclerView.<span class="function">ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (viewType ==ITEM_TYPE_HEADER) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> HeaderViewHolder(mLayoutInflater.inflate(R.layout.rv_header, parent, <span class="keyword">false</span>));</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (viewType == mHeaderCount) &#123;</div><div class="line">            <span class="keyword">return</span>  <span class="keyword">new</span> ContentViewHolder(mLayoutInflater.inflate(R.layout.rv_item, parent, <span class="keyword">false</span>));</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (viewType == ITEM_TYPE_BOTTOM) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> BottomViewHolder(mLayoutInflater.inflate(R.layout.rv_footer, parent, <span class="keyword">false</span>));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="这样添加Header和Footer的功能就简单的实现完成了"><a href="#这样添加Header和Footer的功能就简单的实现完成了" class="headerlink" title="这样添加Header和Footer的功能就简单的实现完成了"></a>这样添加Header和Footer的功能就简单的实现完成了</h3><h2 id="二、GridLayoutManager来实现简单的混搭布局"><a href="#二、GridLayoutManager来实现简单的混搭布局" class="headerlink" title="二、GridLayoutManager来实现简单的混搭布局"></a>二、GridLayoutManager来实现简单的混搭布局</h2><p>其实思想和上面的差不多，重写itemViewType，然后根据不同的type来获取不同的View。但是当List为多列的瀑布流的时候，就需要用到GridLayoutManager来管理了，比如B站的布局。此时需要根据当前item类型来判断占据的横向格数。adapter里面的代码和上面类似就不贴了，现在需要改变的是占据的格数，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">gridManager.setSpanSizeLookup(<span class="keyword">new</span> GridLayoutManager.SpanSizeLookup() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSpanSize</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">                <span class="keyword">if</span>(gradAdapter.getItemViewType(position) == MyAdapter.LABEL_VIEW_TYPE) &#123;</div><div class="line">                    <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure></p>
<p>其中gridManager创建时，定义其spanCount为2，当当前的ViewType为LABEL_VIEW_TYPE时，沾满横向的格数，否则占一个。这里可以根据实际情况来设置不同的spanCount，然后根据不同的ViewType来设置不同的格数，以实现简单的布局混搭。效果图如下<br><img src="http://wiki.hrsoft.net/uploads/201705/592d64eda10d0_592d64ed.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/21/Lover/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Catango">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="猫的储物间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/21/Lover/" itemprop="url">Lover</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-21T17:31:19+08:00">
                2017-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/21/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Catango">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="猫的储物间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/21/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-21T16:53:08+08:00">
                2017-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Catango</p>
              <p class="site-description motion-element" itemprop="description">无喵不欢</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Catango</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v="></script>

  <script type="text/javascript" src="/js/src/motion.js?v="></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v="></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v="></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v="></script>



  


  




	





  





  












  





  

  

  
  

  

  

  

</body>
</html>
